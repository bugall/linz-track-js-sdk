{"version":3,"sources":["../src/track.js"],"names":["debug","require","window","_hmt","storage","store","namespace","name","version","TRACK_CONFIG","huoDongYeShow","tid","ptid","cat","shelfShow","giftClick","musicClick","startTheLotteryClick","openGiftClick","huoDongGuiZeClick","jingPinLiBaoClick","shenTanDanPinClick","xianShiGouClick","lingQuClick","rewardCenterShow","rewardCenterTabClick","shelfProductClick","Track","opts","check","host","trackConstParams","vid","video","proj","project","bu","rs","n","sdk","appkey","client","lang","ssid","ext","resource","user","phone","controller","params","event","isEmpty","trackUrl","makeRequestUrl","console","log","send","tmpUrlParams","cloneDeep","JSON","stringify","url","caller","Image","onload","onerror","error","src"],"mappings":"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","file":"track.js","sourcesContent":["import { script } from 'cy-lib/helper'\nimport _ from 'lodash'\nimport qs from 'query-string'\nimport cyConfig from 'cy-lib/config'\n\nconst debug = require('cy-lib/debug')('track')\nwindow._hmt = window._hmt || []\n\nconst storage = store.namespace(cyConfig.name + '_' + cyConfig.version)\n \nconst TRACK_CONFIG = {\n  huoDongYeShow: {\n    tid: 'huoDongYeShow',\n    ptid: '',\n    cat: 12\n  },\n  shelfShow: {\n    tid: '',\n    ptid: '',\n    cat: 12,\n  }, \n  giftClick: {\n    tid: 'giftClick',\n    ptid: '',\n    cat: 9,\n  },\n  musicClick: {\n    tid: 'musicClick',\n    ptid: '',\n    cat: 9,\n  },\n  startTheLotteryClick: {\n    tid: 'startTheLotteryClick',\n    ptid: '',\n    cat: 9,\n  },\n  openGiftClick: {\n    tid: 'openGiftClick',\n    ptid: '',\n    cat: 9,\n  },\n  huoDongGuiZeClick: {\n    tid: 'huoDongGuiZeClick',\n    ptid: '',\n    cat: 9,\n  },\n  jingPinLiBaoClick: {\n    tid: 'jingPinLiBaoClick',\n    ptid: '',\n    cat: 9,\n  },\n  shenTanDanPinClick: {\n    tid: 'shenTanDanPinClick',\n    ptid: '',\n    cat: 9,\n  },\n  xianShiGouClick: {\n    tid: 'xianShiGouClick',\n    ptid: '',\n    cat: 9,\n  },\n  lingQuClick: {\n    tid: 'lingQuClick',\n    ptid: '',\n    cat: 9,\n  },\n  rewardCenterShow: {\n    tid: '_rewardCenterShow',\n    ptid: '',\n    cat: 12,\n  },\n  rewardCenterTabClick: {\n    tid: 'rewardCenterTabClick',\n    ptid: '',\n    cat: 9,\n  },\n  shelfProductClick: {\n    tid: 'product',\n    ptid: 'productTab',\n    cat: 9,\n  }\n}\nexport default class Track {\n  constructor(opts) {\n    this.check(opts)\n    this.host = opts.host\n    this.trackConstParams = {\n      vid: opts.video || '',\n      proj: opts.project || '',\n      bu: opts.bu || '',\n      rs: opts.rs || '',\n      n: opts.n || '',\n      sdk: opts.sdk || '',\n      appkey: opts.appkey || '',\n      client: opts.client || '',\n      lang: opts.lang || '',\n      ssid: opts.ssid || '',\n      ext: {\n        resource: opts.ext && opts.ext.resource || '',\n        user: opts.user && opts.ext.user || '',\n        phone: opts.phone && opts.ext.phone || '',\n      }\n    }\n  }\n\n  controller = (params) => {\n    const { event, phone, ssid } = params\n    if (!_.isEmpty(phone)) {\n      this.trackConstParams.ext.phone = phone\n    }\n    if (!_.isEmpty(ssid)) {\n      this.trackConstParams.ssid = ssid\n    }\n    \n    if (_.isEmpty(TRACK_CONFIG[event])) {\n      debug(`Track: ${event} 事件不存在`)\n    }\n    const trackUrl = this.makeRequestUrl(params)\n    console.log(trackUrl)\n    this.send(trackUrl)\n  }\n  check = (opts) => {\n    // video为必要字段\n    if (_.isEmpty(opts.video)) {\n      debug('Track: video字段不能为空')\n    }\n    // project项目字段不能为空\n    if (_.isEmpty(opts.project)) {\n      debug('Track: project不能为空')\n    }\n    if (_.isEmpty(opts.bu)) {\n      debug('Track: bu不能为空, 你可以按照业务选择对应的bu(videojj, videoos, liveos)')\n    }\n    if (_.isEmpty(opts.sdk)) {\n      debug('Track: sdk字段不能为空, 请传入正确的值')\n    }\n    if (_.isEmpty(opts.client)) {\n      debug('Track: client字段不能为空, client字段代表客户端的唯一表示')\n    }\n    if (_.isEmpty(opts.ext)) {\n      debug('Track: ext表示为拓展字段, 不能为空')\n    }\n  }\n\n  makeRequestUrl = (opts) => {\n    const { event, phone } = opts\n    const tmpUrlParams = {\n      ..._.cloneDeep(this.trackConstParams),\n      ...TRACK_CONFIG[event],\n    }\n    tmpUrlParams.ext = JSON.stringify(tmpUrlParams.ext)\n\n    debug(`Track: 最终发送的参数, ${JSON.stringify(tmpUrlParams)}`)\n    const url = this.host + '/track/v5/va.gif?' + qs.stringify(tmpUrlParams)\n    return url\n  }\n\n  send = (url) => {\n    const caller = new Image(1, 1)\n    caller.onload = caller.onerror = (error) => {\n      debug(`Track: send error, ${JSON.stringify(error)}(${url})`)\n    }\n    caller.src = url\n  }\n}"]}